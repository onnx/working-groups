<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="icofont.min.css">
<title>Module libtensor.CTensor</title>
</head>
<body>
<header><a href="index.html">index</a> — <code>library <a href="libtensor.index.html">libtensor</a></code> — <code>module CTensor</code></header>
<pre class="src">
<span class="keyword">module</span> <span class="scope">CTensor</span><a href="libtensor.proof.html#CTensor" title="Valid (13 goals)" class="icon valid icofont-check"></a>
  <span class="keyword">use</span> tensor.std.<a title="tensor.std.Int" href="https://www.why3.org/stdlib/tensor.std.html#Int_">Int</a>
  <span class="keyword">use</span> tensor.std.<a title="tensor.std.List" href="https://www.why3.org/stdlib/tensor.std.html#List_">List</a>
  <span class="keyword">use</span> tensor.std.<a title="tensor.std.Clib" href="https://www.why3.org/stdlib/tensor.std.html#Clib_">Clib</a>
  <span class="keyword">use</span> tensor.std.<a title="tensor.std.Cfloat" href="https://www.why3.org/stdlib/tensor.std.html#Cfloat_">Cfloat</a>
  <span class="keyword">use</span> mach.int.<a title="mach.int.Int32" href="https://www.why3.org/stdlib/mach.int.html#Int32_">Int32</a>
  <span class="keyword">use</span> tensor.tensor.<a title="tensor.tensor.Range" href="https://www.why3.org/stdlib/tensor.tensor.html#Range_">Range</a>
  <span class="keyword">use</span> tensor.tensor.<a title="tensor.tensor.Tensor" href="https://www.why3.org/stdlib/tensor.tensor.html#Tensor_">Tensor</a>
  <span class="keyword">use</span> tensor.layout.<a title="tensor.layout.CFlat" href="https://www.why3.org/stdlib/tensor.layout.html#CFlat_">CFlat</a>
  <span class="keyword">use</span> tensor.libvector.<a title="tensor.libvector.CIndex" href="https://www.why3.org/stdlib/tensor.libvector.html#CIndex_">CIndex</a>


  <span class="keyword">type</span> <a id="farray">farray</a> = <a title="mach.c.C.ptr" href="https://www.why3.org/stdlib/mach.c.html#ptr_21">ptr</a> <a title="tensor.std.Cfloat.float" href="https://www.why3.org/stdlib/tensor.std.html#float_139">float</a>

  <span class="keyword">type</span> <a id="ctensor">ctensor</a> = {
    <a id="t_rank">t_rank</a> : <a title="mach.int.Int32.int32" href="https://www.why3.org/stdlib/mach.int.html#int32_283">int32</a> ;
    <a id="t_dims">t_dims</a> : <a title="tensor.libvector.CIndex.iarray" href="https://www.why3.org/stdlib/tensor.libvector.html#iarray_11">iarray</a> ;
    <a id="t_data">t_data</a> : <a title="libtensor.CTensor.farray" href="#farray">farray</a> ;
  }

  <span class="keyword">function</span> <a id="tensor_dim">tensor_dim</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int = <a title="tensor.libvector.CIndex.ivector" href="https://www.why3.org/stdlib/tensor.libvector.html#ivector_13">ivector</a> t.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> t.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a>
  <span class="keyword">function</span> <a id="tensor_size">tensor_size</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : int = <a title="tensor.libvector.CIndex.vdim" href="https://www.why3.org/stdlib/tensor.libvector.html#vdim_21">vdim</a> t.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> t.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a>
  <span class="keyword">predicate</span> <a id="valid_index">valid_index</a> (k : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int) (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) = <a title="tensor.tensor.Range.valid" href="https://www.why3.org/stdlib/tensor.tensor.html#valid_19">valid</a> k (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t)
  <span class="keyword">predicate</span> <a id="empty_tensor">empty_tensor</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) = t.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> = 0

  <span class="keyword">predicate</span> <a id="valid_tensor">valid_tensor</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) =
    <a title="tensor.libvector.CIndex.dimension" href="https://www.why3.org/stdlib/tensor.libvector.html#dimension_27">dimension</a> t.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> t.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> /\
    <a title="tensor.std.Clib.valid_range" href="https://www.why3.org/stdlib/tensor.std.html#valid_range_70">valid_range</a> t.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a> 0 (<a title="libtensor.CTensor.tensor_size" href="#tensor_size">tensor_size</a> t) /\
    <a title="mach.c.C.writable" href="https://www.why3.org/stdlib/mach.c.html#writable_26">writable</a> t.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a>

  <span class="keyword">function</span> <a id="tensor_offset">tensor_offset</a> (k : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int) (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : int = <a title="tensor.layout.CFlat.offset" href="https://www.why3.org/stdlib/tensor.layout.html#offset_6">offset</a> k (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t)

  <span class="keyword">function</span> <a id="tensor_value_at">tensor_value_at</a> (k : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int) (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : real =
    <span class="keyword">if</span> <a title="libtensor.CTensor.valid_index" href="#valid_index">valid_index</a> k t <span class="keyword">then</span>
      <a title="tensor.std.Clib.value_at" href="https://www.why3.org/stdlib/tensor.std.html#value_at_86">value_at</a> t.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a> (<a title="libtensor.CTensor.tensor_offset" href="#tensor_offset">tensor_offset</a> k t)
    <span class="keyword">else</span> 0.0

  <span class="keyword">function</span> <a id="tensor_value">tensor_value</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int -&gt; real =
    <span class="keyword">fun</span> k -&gt; <a title="libtensor.CTensor.tensor_value_at" href="#tensor_value_at">tensor_value_at</a> k t

  <span class="keyword">function</span> <a id="tensor_valueb">tensor_valueb</a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : <a title="list.List.list" href="https://www.why3.org/stdlib/list.html#list_8">list</a> int -&gt; bool =
    <span class="keyword">fun</span> k -&gt; Real.(<a title="libtensor.CTensor.tensor_value_at" href="#tensor_value_at">tensor_value_at</a> k t <a title="real.Real.(>)" href="https://www.why3.org/stdlib/real.html#infix%20%3E_23">&gt;</a> 0.0)

  <span class="keyword">let</span> <span class="keyword">ghost</span> <span class="keyword">function</span> <a id="tensor">tensor</a><a href="libtensor.proof.html#CTensor.tensor" title="Valid (one goal)" class="icon valid icofont-check"></a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : <a title="tensor.tensor.Tensor.tensor" href="https://www.why3.org/stdlib/tensor.tensor.html#tensor_79">tensor</a> real
    <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
    <span class="keyword">requires</span> { <a title="libtensor.CTensor.valid_tensor" href="#valid_tensor">valid_tensor</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.dims" href="https://www.why3.org/stdlib/tensor.tensor.html#dims_80">dims</a> = <a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.data" href="https://www.why3.org/stdlib/tensor.tensor.html#data_81">data</a> = <a title="libtensor.CTensor.tensor_value" href="#tensor_value">tensor_value</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.background" href="https://www.why3.org/stdlib/tensor.tensor.html#background_82">background</a> = 0.0 }
    <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>
    = {
      <a title="tensor.tensor.Tensor.dims" href="https://www.why3.org/stdlib/tensor.tensor.html#dims_80">dims</a> = <span class="keyword">pure</span> { <a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t } ;
      <a title="tensor.tensor.Tensor.data" href="https://www.why3.org/stdlib/tensor.tensor.html#data_81">data</a> = <span class="keyword">pure</span> { <a title="libtensor.CTensor.tensor_value" href="#tensor_value">tensor_value</a> t } ;
      <a title="tensor.tensor.Tensor.background" href="https://www.why3.org/stdlib/tensor.tensor.html#background_82">background</a> = 0.0 ;
    }

  <span class="keyword">let</span> <span class="keyword">ghost</span> <span class="keyword">function</span> <a id="tensorb">tensorb</a><a href="libtensor.proof.html#CTensor.tensorb" title="Valid (one goal)" class="icon valid icofont-check"></a> (t : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) : <a title="tensor.tensor.Tensor.tensor" href="https://www.why3.org/stdlib/tensor.tensor.html#tensor_79">tensor</a> bool
    <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
    <span class="keyword">requires</span> { <a title="libtensor.CTensor.valid_tensor" href="#valid_tensor">valid_tensor</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.dims" href="https://www.why3.org/stdlib/tensor.tensor.html#dims_80">dims</a> = <a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.data" href="https://www.why3.org/stdlib/tensor.tensor.html#data_81">data</a> = <a title="libtensor.CTensor.tensor_valueb" href="#tensor_valueb">tensor_valueb</a> t }
    <span class="keyword">ensures</span> { result.<a title="tensor.tensor.Tensor.background" href="https://www.why3.org/stdlib/tensor.tensor.html#background_82">background</a> = <span class="keyword">false</span> }
    <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>
    = {
      <a title="tensor.tensor.Tensor.dims" href="https://www.why3.org/stdlib/tensor.tensor.html#dims_80">dims</a> = <span class="keyword">pure</span> { <a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> t } ;
      <a title="tensor.tensor.Tensor.data" href="https://www.why3.org/stdlib/tensor.tensor.html#data_81">data</a> = <span class="keyword">pure</span> { <a title="libtensor.CTensor.tensor_valueb" href="#tensor_valueb">tensor_valueb</a> t } ;
      <a title="tensor.tensor.Tensor.background" href="https://www.why3.org/stdlib/tensor.tensor.html#background_82">background</a> = <span class="keyword">false</span> ;
    }

  <span class="keyword">let</span> <a id="ctensor_create">ctensor_create</a><a href="libtensor.proof.html#CTensor.ctensor_create" title="Valid (one goal)" class="icon valid icofont-check"></a> (ds : <a title="tensor.libvector.CIndex.iarray" href="https://www.why3.org/stdlib/tensor.libvector.html#iarray_11">iarray</a>) (n : <a title="mach.int.Int32.int32" href="https://www.why3.org/stdlib/mach.int.html#int32_283">int32</a>) : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a> =
    <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
    <span class="keyword">requires</span> { <a title="tensor.libvector.CIndex.dimension" href="https://www.why3.org/stdlib/tensor.libvector.html#dimension_27">dimension</a> ds n }
    <span class="keyword">ensures</span> { <a title="libtensor.CTensor.empty_tensor" href="#empty_tensor">empty_tensor</a> result \/ <a title="libtensor.CTensor.valid_tensor" href="#valid_tensor">valid_tensor</a> result }
    <span class="keyword">ensures</span> { <a title="libtensor.CTensor.empty_tensor" href="#empty_tensor">empty_tensor</a> result \/ result.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> = n }
    <span class="keyword">ensures</span> { <a title="libtensor.CTensor.empty_tensor" href="#empty_tensor">empty_tensor</a> result \/ result.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> = ds }
    <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>
    <span class="keyword">let</span> m = <a title="tensor.libvector.CIndex.cdim_size" href="https://www.why3.org/stdlib/tensor.libvector.html#cdim_size_48">cdim_size</a> ds n <span class="keyword">in</span>
    <span class="keyword">let</span> vs = <a title="mach.c.C.malloc" href="https://www.why3.org/stdlib/mach.c.html#malloc_100">malloc</a> (<a title="tensor.std.Clib.to_uint32" href="https://www.why3.org/stdlib/tensor.std.html#to_uint32_61">to_uint32</a> m) <span class="keyword">in</span>
    {
      <a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> = <span class="keyword">if</span> <a title="tensor.std.Clib.is_null" href="https://www.why3.org/stdlib/tensor.std.html#is_null_66">is_null</a> vs <span class="keyword">then</span> 0 <span class="keyword">else</span> n ;
      <a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> = ds ;
      <a title="libtensor.CTensor.t_data" href="#t_data">t_data</a> = vs ;
    }

  <span class="keyword">let</span> <a id="ctensor_clear">ctensor_clear</a><a href="libtensor.proof.html#CTensor.ctensor_clear" title="Valid (one goal)" class="icon valid icofont-check"></a> (r : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) =
    <span class="keyword">requires</span> { <a title="libtensor.CTensor.valid_tensor" href="#valid_tensor">valid_tensor</a> r }
    <span class="keyword">ensures</span> { <a title="libtensor.CTensor.tensor" href="#tensor">tensor</a> r = Tensor.<a title="tensor.tensor.Tensor.zero" href="https://www.why3.org/stdlib/tensor.tensor.html#zero_118">zero</a> 0.0 (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> r) }
    <span class="keyword">let</span> m = <a title="tensor.libvector.CIndex.cdim_size" href="https://www.why3.org/stdlib/tensor.libvector.html#cdim_size_48">cdim_size</a> r.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> r.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> <span class="keyword">in</span>
    <span class="keyword">for</span> i = 0 <span class="keyword">to</span> m<a title="int.Int.(-)" href="https://www.why3.org/stdlib/int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
      <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
      <span class="keyword">invariant</span> { <span class="keyword">forall</span> k. 0 <a title="int.Int.(<=)" href="https://www.why3.org/stdlib/int.html#infix%20%3C=_25">&lt;=</a> k <a title="int.Int.(<)" href="https://www.why3.org/stdlib/int.html#infix%20%3C_21">&lt;</a> i -&gt; <a title="tensor.std.Clib.value_at" href="https://www.why3.org/stdlib/tensor.std.html#value_at_86">value_at</a> r.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a> k = 0.0 }
      <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>
      r.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a>[i] &lt;- <a title="tensor.std.Cfloat.f32" href="https://www.why3.org/stdlib/tensor.std.html#f32_145">f32</a> 0.0
    <span class="keyword">done</span>
    <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
    ; <span class="keyword">assert</span> { <a title="libtensor.CTensor.tensor" href="#tensor">tensor</a> r <a title="tensor.tensor.Tensor.(==)" href="https://www.why3.org/stdlib/tensor.tensor.html#infix%20==_101">==</a> Tensor.<a title="tensor.tensor.Tensor.zero" href="https://www.why3.org/stdlib/tensor.tensor.html#zero_118">zero</a> 0.0 (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> r) }
    <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>

  <span class="keyword">let</span> <a id="ctensor_reset">ctensor_reset</a><a href="libtensor.proof.html#CTensor.ctensor_reset" title="Valid (9 goals)" class="icon valid icofont-check"></a> (r : <a title="libtensor.CTensor.ctensor" href="#ctensor">ctensor</a>) (v : <a title="tensor.std.Cfloat.float" href="https://www.why3.org/stdlib/tensor.std.html#float_139">float</a>) =
    <span class="keyword">requires</span> { <a title="libtensor.CTensor.valid_tensor" href="#valid_tensor">valid_tensor</a> r }
    <span class="keyword">ensures</span> { <a title="libtensor.CTensor.tensor" href="#tensor">tensor</a> r = Tensor.<a title="tensor.tensor.Tensor.const" href="https://www.why3.org/stdlib/tensor.tensor.html#const_129">const</a> (<a title="tensor.std.Cfloat.to_real" href="https://www.why3.org/stdlib/tensor.std.html#to_real_139">to_real</a> v) 0.0 (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> r) }
    <span class="keyword">let</span> m = <a title="tensor.libvector.CIndex.cdim_size" href="https://www.why3.org/stdlib/tensor.libvector.html#cdim_size_48">cdim_size</a> r.<a title="libtensor.CTensor.t_dims" href="#t_dims">t_dims</a> r.<a title="libtensor.CTensor.t_rank" href="#t_rank">t_rank</a> <span class="keyword">in</span>
    <span class="keyword">for</span> i = 0 <span class="keyword">to</span> m<a title="int.Int.(-)" href="https://www.why3.org/stdlib/int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
      <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
      <span class="keyword">invariant</span> { <span class="keyword">forall</span> k. 0 <a title="int.Int.(<=)" href="https://www.why3.org/stdlib/int.html#infix%20%3C=_25">&lt;=</a> k <a title="int.Int.(<)" href="https://www.why3.org/stdlib/int.html#infix%20%3C_21">&lt;</a> i -&gt; <a title="tensor.std.Clib.value_at" href="https://www.why3.org/stdlib/tensor.std.html#value_at_86">value_at</a> r.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a> k = v }
      <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>
      r.<a title="libtensor.CTensor.t_data" href="#t_data">t_data</a>[i] &lt;- v
    <span class="keyword">done</span>
    <span class="section level1"><span class="comment">{</span><span class="attribute section-toggle">proof</span><span class="comment section-text active">…</span><span class="comment">}</span><span class="section-text">
    ; <span class="keyword">assert</span> { <a title="libtensor.CTensor.tensor" href="#tensor">tensor</a> r <a title="tensor.tensor.Tensor.(==)" href="https://www.why3.org/stdlib/tensor.tensor.html#infix%20==_101">==</a> Tensor.<a title="tensor.tensor.Tensor.const" href="https://www.why3.org/stdlib/tensor.tensor.html#const_129">const</a> (<a title="tensor.std.Cfloat.to_real" href="https://www.why3.org/stdlib/tensor.std.html#to_real_139">to_real</a> v) 0.0 (<a title="libtensor.CTensor.tensor_dim" href="#tensor_dim">tensor_dim</a> r) }
    <span class="comment">{</span><span class="attribute section-toggle">qed</span><span class="comment">}</span></span></span>




<span class="keyword">end</span>
</pre>
<script type="text/javascript" src="script.js"></script>
</body>
</html>
